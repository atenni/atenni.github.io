<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">

  <!-- Theme detection script. Must be early to prevent theme switching flash -->
  <script>
    (function () {
      // Priority 1: localStorage theme if available
      var savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        return;
      }

      // Priority 2: system preference if available
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
        return;
      }

      // Priority 3: dark is already set as default in the HTML tag
    })();
  </script>

  <!-- Resource hints for critical CSS files -->
  <link rel="preload" href="{{ '/assets/css/variables.css' | relative_url }}" as="style">
  <link rel="preload" href="{{ '/assets/css/base.css' | relative_url }}" as="style">
  <link rel="preload" href="{{ '/assets/css/layout.css' | relative_url }}" as="style">

  <!-- CSS files in optimized load order -->
  <link rel="stylesheet" href="{{ '/assets/css/variables.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/base.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/layout.css' | relative_url }}">

  <!-- Component styles -->
  <link rel="stylesheet" href="{{ '/assets/css/components/theme-switch.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/components/header.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/components/footer.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/components/tables.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/components/code-highlighting.css' | relative_url }}">

  <!-- Layout-specific styles -->
  {%- case page.layout -%}
    {%- when 'home' -%}
      <link rel="stylesheet" href="{{ '/assets/css/layouts/home.css' | relative_url }}">
    {%- when 'page' -%}
      <link rel="stylesheet" href="{{ '/assets/css/layouts/page.css' | relative_url }}">
    {%- when 'post' -%}
      <link rel="stylesheet" href="{{ '/assets/css/layouts/post.css' | relative_url }}">
  {%- endcase -%}

  {%- feed_meta -%}

  {%- seo -%}

  {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
  {%- endif -%}
</head>
